<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Interpreter (compiler.Course_language.Interpreter)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">compiler</a> &#x00BB; <a href="../index.html">Course_language</a> &#x00BB; Interpreter</nav><header class="odoc-preamble"><h1>Module <code><span>Course_language.Interpreter</span></code></h1><p>Module defining the interpreter of the course language defined in the module Ast. It contains the definition of the abstract machine on which it is runned, and the functions interpreting expressions, instructions and lists of functions declarations in the language.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec exception anchored" id="exception-Return_exp"><a href="#exception-Return_exp" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Return_exp</span> <span class="keyword">of</span> <span><a href="../../Abstract_machine/index.html#type-value">Abstract_machine.value</a> option</span></span></code></div><div class="spec-doc"><p>Exception that should be used for handling return values of function calls in the interpreter.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Non_variable_reference"><a href="#exception-Non_variable_reference" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Non_variable_reference</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-expr">Ast.expr</a></span></code></div><div class="spec-doc"><p>Exception raised by the interpreter in case something else than a variable is passed as a reference to a function call.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Non_bool_test"><a href="#exception-Non_bool_test" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Non_bool_test</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-expr">Ast.expr</a></span></code></div><div class="spec-doc"><p>Exception raised by the interpreter if a non-boolean value appears in an <code>if</code> or a <code>while</code>.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Non_integer_array_position"><a href="#exception-Non_integer_array_position" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Non_integer_array_position</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-expr">Ast.expr</a></span></code></div><div class="spec-doc"><p>Exception raised by the interpreter whenever trying to access a non-integer position of an array, or declaring an array of non-integer size.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-operation_of_binop"><a href="#val-operation_of_binop" class="anchor"></a><code><span><span class="keyword">val</span> operation_of_binop : 
  <span><a href="../Ast/index.html#type-binop">Ast.binop</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Abstract_machine/index.html#type-value">Abstract_machine.value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Abstract_machine/index.html#type-value">Abstract_machine.value</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../Abstract_machine/index.html#type-value">Abstract_machine.value</a></span></code></div><div class="spec-doc"><p>Function that associates to a <code>binop</code> a function over machine values that corresponds to it. <code>operation_of_binop op v1 v2</code> returns the result of the application of <code>op</code> to <code>v1</code> and <code>v2</code>.</p><p><b>Raises :</b></p><ul><li><a href="../../Abstract_machine/index.html#exception-Wrong_type_operand"><code>Abstract_machine.Wrong_type_operand</code></a> or <code>Failure</code> if the abstract machine instruction(s) called to simulate <code>op</code> do so.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-operation_of_unop"><a href="#val-operation_of_unop" class="anchor"></a><code><span><span class="keyword">val</span> operation_of_unop : 
  <span><a href="../Ast/index.html#type-unop">Ast.unop</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Abstract_machine/index.html#type-value">Abstract_machine.value</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../Abstract_machine/index.html#type-value">Abstract_machine.value</a></span></code></div><div class="spec-doc"><p>Function that associates to a <code>unop</code> a function over machine values that corresponds to it. <code>operation_of_unop op v</code> returns the result of the application of <code>op</code> to <code>v</code>.</p><p><b>Raises :</b></p><ul><li><a href="../../Abstract_machine/index.html#exception-Wrong_type_operand"><code>Abstract_machine.Wrong_type_operand</code></a> or <code>Failure</code> if the abstract machine instruction(s) called to simulate <code>op</code> do so.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-interpret_expr"><a href="#val-interpret_expr" class="anchor"></a><code><span><span class="keyword">val</span> interpret_expr : 
  <span><span><a href="../../Abstract_machine/index.html#type-value">Abstract_machine.value</a> <a href="../../Util/Environment/index.html#type-t">Util.Environment.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><a href="../Ast/index.html#type-argument">Ast.argument</a> list</span> * <a href="../Ast/index.html#type-instruction">Ast.instruction</a>)</span> <a href="../../Util/Environment/index.html#type-t">Util.Environment.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Ast/index.html#type-expr">Ast.expr</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../Abstract_machine/index.html#type-value">Abstract_machine.value</a></span></code></div><div class="spec-doc"><p><code>interpret_expr env functions expr</code> computes the value of <code>expr</code> with environment <code>env</code> and function list <code>functions</code>. It can modify <code>env</code> through side effects of function calls.</p><p><b>Raises :</b></p><ul><li><a href="../../Abstract_machine/index.html#exception-Wrong_type_operand"><code>Abstract_machine.Wrong_type_operand</code></a> or <code>Failure</code> if an operation of the abstract machine called here raises it.</li><li>Any exception raised by <a href="#val-interpret_instruction"><code>interpret_instruction</code></a> called for evaluating a <a href="../Ast/index.html#type-expr.Func"><code>Ast.expr.Func</code></a> expression, except <a href="#exception-Return_exp"><code>Return_exp</code></a> which is catched here.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-interpret_instruction"><a href="#val-interpret_instruction" class="anchor"></a><code><span><span class="keyword">val</span> interpret_instruction : 
  <span><span><a href="../../Abstract_machine/index.html#type-value">Abstract_machine.value</a> <a href="../../Util/Environment/index.html#type-t">Util.Environment.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><a href="../Ast/index.html#type-argument">Ast.argument</a> list</span> * <a href="../Ast/index.html#type-instruction">Ast.instruction</a>)</span> <a href="../../Util/Environment/index.html#type-t">Util.Environment.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Ast/index.html#type-instruction">Ast.instruction</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>interpret_instruction env functions instruction</code> applies the effect of instruction <code>instruction</code> on environment <code>env</code>, in a context where the known functions are in <code>functions</code>. It does not return any value, as our instruction do not have values, so it only applies side-effects on <code>env</code>.</p><p><b>Raises:</b></p><ul><li><a href="#exception-Return_exp"><code>Return_exp</code></a> when the instruction is (or contains) <a href="../Ast/index.html#type-instruction.Return"><code>Ast.instruction.Return</code></a>.</li><li><a href="#exception-Non_bool_test"><code>Non_bool_test</code></a> when the instruction is <a href="../Ast/index.html#type-instruction.IfThenElse"><code>Ast.instruction.IfThenElse</code></a> or <a href="../Ast/index.html#type-instruction.While"><code>Ast.instruction.While</code></a> and the expression that is the test does not evaluate as a boolean.</li><li><a href="#exception-Non_variable_reference"><code>Non_variable_reference</code></a> when the instruction is <a href="../Ast/index.html#type-instruction.Proc"><code>Ast.instruction.Proc</code></a> and one of the expression provided for an argument that is passed for a reference argument is not of the form <a href="../Ast/index.html#type-expr.Var"><code>Ast.expr.Var</code></a>.</li><li>Any exception raised by <a href="#val-interpret_expr"><code>interpret_expr</code></a> when evaluating an expression inside <code>instruction</code>.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-interpret_func_decl"><a href="#val-interpret_func_decl" class="anchor"></a><code><span><span class="keyword">val</span> interpret_func_decl : 
  <span><span><span>(<span><a href="../Ast/index.html#type-argument">Ast.argument</a> list</span> * <a href="../Ast/index.html#type-instruction">Ast.instruction</a>)</span> <a href="../../Util/Environment/index.html#type-t">Util.Environment.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Ast/index.html#type-function_decl">Ast.function_decl</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>interpret_func_decl functions declaration</code> modifies the functions environment <code>functions</code> to add to it the function declared by <code>declaration</code>. If the function declared in <code>declaration</code> was already mapped in <code>functions</code>, the previous declaration is forgotten.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-interpret_prg"><a href="#val-interpret_prg" class="anchor"></a><code><span><span class="keyword">val</span> interpret_prg : <span><span><a href="../Ast/index.html#type-function_decl">Ast.function_decl</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>interpret_prg prg</code> computes a function environment <code>functions</code> from the list of declarations <code>prg</code>, and then calls the procedure called &quot;main&quot; on an empty environment with the known functions <code>functions</code>. It does not return anything, but the prints made by executing the program will be in <code>stdout</code>.</p><p><b>Raises:</b></p><ul><li>Anything that can be raised by <a href="#val-interpret_instruction"><code>interpret_instruction</code></a>, except <a href="#exception-Return_exp"><code>Return_exp</code></a> which is catched here if it occurs during main, or by <a href="#val-interpret_expr"><code>interpret_expr</code></a>.</li></ul></div></div></div></body></html>
